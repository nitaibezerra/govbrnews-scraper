name: Manual Scraper Dispatch

on:
  workflow_dispatch:
    inputs:
      min-date:
        description: 'Start date for scraping (format: YYYY-MM-DD)'
        required: true
      max-date:
        description: 'End date for scraping (format: YYYY-MM-DD, leave empty to use min-date)'
        required: false
        default: ''

jobs:
  setup-dates:
    name: Setup Date Variables
    runs-on: ubuntu-latest
    outputs:
      start_date: ${{ steps.dates.outputs.start_date }}
      end_date: ${{ steps.dates.outputs.end_date }}
    steps:
      - name: Set date variables
        id: dates
        run: |
          echo "start_date=${{ github.event.inputs.min-date }}" >> $GITHUB_OUTPUT
          if [ -n "${{ github.event.inputs.max-date }}" ]; then
            echo "end_date=${{ github.event.inputs.max-date }}" >> $GITHUB_OUTPUT
          else
            echo "end_date=${{ github.event.inputs.min-date }}" >> $GITHUB_OUTPUT
          fi

      - name: Print date information
        run: |
          echo "Pipeline will process from ${{ steps.dates.outputs.start_date }} to ${{ steps.dates.outputs.end_date }}"

  run-pipeline:
    name: Run News Processing Pipeline
    needs: setup-dates
    uses: ./.github/workflows/pipeline-steps.yaml
    with:
      start_date: ${{ needs.setup-dates.outputs.start_date }}
      end_date: ${{ needs.setup-dates.outputs.end_date }}
    secrets:
      HF_TOKEN: ${{ secrets.HF_TOKEN }}
      COGFY_API_KEY: ${{ secrets.COGFY_API_KEY }}